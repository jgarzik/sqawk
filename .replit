modules = ["rust"]

[nix]
channel = "stable-24_05"

[workflows]
runButton = "Project"

[[workflows.workflow]]
name = "Project"
mode = "parallel"
author = "agent"

[[workflows.workflow.tasks]]
task = "workflow.run"
args = "sqawk-build-and-run"

[[workflows.workflow.tasks]]
task = "workflow.run"
args = "Test Less Than Operator"

[[workflows.workflow.tasks]]
task = "workflow.run"
args = "Test Boundary Value"

[[workflows.workflow.tasks]]
task = "workflow.run"
args = "Test Min Boundary Comparison"

[[workflows.workflow.tasks]]
task = "workflow.run"
args = "Test Max Boundary Value"

[[workflows.workflow.tasks]]
task = "workflow.run"
args = "Run Comparison Tests"

[[workflows.workflow.tasks]]
task = "workflow.run"
args = "Sqawk Build and Run"

[[workflows.workflow.tasks]]
task = "workflow.run"
args = "Test DELETE Query"

[[workflows.workflow.tasks]]
task = "workflow.run"
args = "Test DELETE All"

[[workflows.workflow.tasks]]
task = "workflow.run"
args = "Test UPDATE Query"

[[workflows.workflow.tasks]]
task = "workflow.run"
args = "Test UPDATE All Rows"

[[workflows.workflow]]
name = "sqawk-build-and-run"
author = "agent"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = """
cd $(pwd) && cargo build && echo -e \"
--- Testing basic query ---\" && cargo run -- -s \"SELECT * FROM sample\" tests/data/sample.csv"""

[[workflows.workflow]]
name = "Test Less Than Operator"
author = "agent"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "cd $(pwd) && cargo run -- -s \"SELECT * FROM sample WHERE age <= 30\" tests/data/sample.csv -v"

[[workflows.workflow]]
name = "Test Boundary Value"
author = "agent"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "cd $(pwd) && cargo run -- -s \"SELECT * FROM boundaries WHERE value = -9223372036854775808\" tests/data/boundaries.csv -v"

[[workflows.workflow]]
name = "Test Min Boundary Comparison"
author = "agent"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "cd $(pwd) && cargo run -- -s \"SELECT * FROM boundaries WHERE value < 0\" tests/data/boundaries.csv -v"

[[workflows.workflow]]
name = "Test Max Boundary Value"
author = "agent"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "cd $(pwd) && cargo run -- -s \"SELECT * FROM boundaries WHERE value = 9223372036854775807\" tests/data/boundaries.csv -v"

[[workflows.workflow]]
name = "Run Comparison Tests"
author = "agent"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "cd $(pwd) && RUST_TEST_THREADS=1 cargo test"

[[workflows.workflow]]
name = "Sqawk Build and Run"
author = "agent"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "cargo build && echo \"Testing Sqawk with sample data:\" && cargo run --bin sqawk -- -s \"SELECT * FROM sample\" tests/data/sample.csv -v"

[[workflows.workflow]]
name = "Test DELETE Query"
author = "agent"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "cd $(pwd) && cargo run --bin sqawk -- -s \"DELETE FROM sample WHERE age > 30\" -s \"SELECT * FROM sample\" tests/data/sample.csv -v"

[[workflows.workflow]]
name = "Test DELETE All"
author = "agent"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "cd $(pwd) && cargo run --bin sqawk -- -s \"DELETE FROM sample\" -s \"SELECT * FROM sample\" tests/data/sample.csv -v"

[[workflows.workflow]]
name = "Test UPDATE Query"
author = "agent"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "cd $(pwd) && cargo run -- -s \"UPDATE sample SET age = 31 WHERE name = 'Alice'\" -s \"SELECT * FROM sample\" tests/data/sample.csv -v"

[[workflows.workflow]]
name = "Test UPDATE All Rows"
author = "agent"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "cd $(pwd) && cargo run -- -s \"UPDATE sample SET name = 'Updated'\" -s \"SELECT * FROM sample\" tests/data/sample.csv -v"

[deployment]
run = ["sh", "-c", "cargo build && echo \"Testing Sqawk with sample data:\" && cargo run -- -s \"SELECT * FROM sample\" tests/data/sample.csv -v"]
