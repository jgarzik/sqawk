modules = ["rust"]

[nix]
channel = "stable-24_05"

[workflows]
runButton = "Project"

[[workflows.workflow]]
name = "Project"
mode = "parallel"
author = "agent"

[[workflows.workflow.tasks]]
task = "workflow.run"
args = "sqawk-build-and-run"

[[workflows.workflow.tasks]]
task = "workflow.run"
args = "Test Less Than Operator"

[[workflows.workflow.tasks]]
task = "workflow.run"
args = "Test Boundary Value"

[[workflows.workflow.tasks]]
task = "workflow.run"
args = "Test Min Boundary Comparison"

[[workflows.workflow.tasks]]
task = "workflow.run"
args = "Test Max Boundary Value"

[[workflows.workflow.tasks]]
task = "workflow.run"
args = "Run Comparison Tests"

[[workflows.workflow.tasks]]
task = "workflow.run"
args = "Sqawk Build and Run"

[[workflows.workflow.tasks]]
task = "workflow.run"
args = "Test DELETE Query"

[[workflows.workflow.tasks]]
task = "workflow.run"
args = "Test DELETE All"

[[workflows.workflow.tasks]]
task = "workflow.run"
args = "Test UPDATE Query"

[[workflows.workflow.tasks]]
task = "workflow.run"
args = "Test UPDATE All Rows"

[[workflows.workflow.tasks]]
task = "workflow.run"
args = "Test Cross Join"

[[workflows.workflow.tasks]]
task = "workflow.run"
args = "Test Three Table Join"

[[workflows.workflow.tasks]]
task = "workflow.run"
args = "Test Inner Join"

[[workflows.workflow.tasks]]
task = "workflow.run"
args = "Debug Join Column Names"

[[workflows.workflow.tasks]]
task = "workflow.run"
args = "Test Inner Join With Correct Names"

[[workflows.workflow.tasks]]
task = "workflow.run"
args = "Test Simple Join Query"

[[workflows.workflow.tasks]]
task = "workflow.run"
args = "Test Three-Way Inner Join"

[[workflows.workflow.tasks]]
task = "workflow.run"
args = "Test Three-Way Inner Join Without Aliases"

[[workflows.workflow]]
name = "sqawk-build-and-run"
author = "agent"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = """
cd $(pwd) && cargo build && echo -e \"
--- Testing basic query ---\" && cargo run -- -s \"SELECT * FROM sample\" tests/data/sample.csv"""

[[workflows.workflow]]
name = "Test Less Than Operator"
author = "agent"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "cd $(pwd) && cargo run -- -s \"SELECT * FROM sample WHERE age <= 30\" tests/data/sample.csv -v"

[[workflows.workflow]]
name = "Test Boundary Value"
author = "agent"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "cd $(pwd) && cargo run -- -s \"SELECT * FROM boundaries WHERE value = -9223372036854775808\" tests/data/boundaries.csv -v"

[[workflows.workflow]]
name = "Test Min Boundary Comparison"
author = "agent"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "cd $(pwd) && cargo run -- -s \"SELECT * FROM boundaries WHERE value < 0\" tests/data/boundaries.csv -v"

[[workflows.workflow]]
name = "Test Max Boundary Value"
author = "agent"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "cd $(pwd) && cargo run -- -s \"SELECT * FROM boundaries WHERE value = 9223372036854775807\" tests/data/boundaries.csv -v"

[[workflows.workflow]]
name = "Run Comparison Tests"
author = "agent"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "cd $(pwd) && RUST_TEST_THREADS=1 cargo test"

[[workflows.workflow]]
name = "Sqawk Build and Run"
author = "agent"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "cargo build && echo \"Testing Sqawk with sample data:\" && cargo run --bin sqawk -- -s \"SELECT * FROM sample\" tests/data/sample.csv -v"

[[workflows.workflow]]
name = "Test DELETE Query"
author = "agent"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "cd $(pwd) && cargo run --bin sqawk -- -s \"DELETE FROM sample WHERE age > 30\" -s \"SELECT * FROM sample\" tests/data/sample.csv -v"

[[workflows.workflow]]
name = "Test DELETE All"
author = "agent"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "cd $(pwd) && cargo run --bin sqawk -- -s \"DELETE FROM sample\" -s \"SELECT * FROM sample\" tests/data/sample.csv -v"

[[workflows.workflow]]
name = "Test UPDATE Query"
author = "agent"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "cd $(pwd) && cargo run -- -s \"UPDATE sample SET age = 31 WHERE name = 'Alice'\" -s \"SELECT * FROM sample\" tests/data/sample.csv -v"

[[workflows.workflow]]
name = "Test UPDATE All Rows"
author = "agent"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "cd $(pwd) && cargo run -- -s \"UPDATE sample SET name = 'Updated'\" -s \"SELECT * FROM sample\" tests/data/sample.csv -v"

[[workflows.workflow]]
name = "Test Cross Join"
author = "agent"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "cd $(pwd) && cargo run --bin sqawk -- -s \"SELECT * FROM users, orders\" tests/data/users.csv tests/data/orders.csv -v"

[[workflows.workflow]]
name = "Test Three Table Join"
author = "agent"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "cd $(pwd) && cargo run --bin sqawk -- -s \"SELECT * FROM users, orders, products\" tests/data/users.csv tests/data/orders.csv tests/data/products.csv -v"

[[workflows.workflow]]
name = "Test Inner Join"
author = "agent"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "cd $(pwd) && cargo run --bin sqawk -- -s \"SELECT users.name, products.name, products.price, orders.date FROM users, orders, products WHERE orders.user_id = users.id AND orders.product_id = products.product_id\" tests/data/users.csv tests/data/orders.csv tests/data/products.csv -v"

[[workflows.workflow]]
name = "Debug Join Column Names"
author = "agent"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "cd $(pwd) && cargo run --bin sqawk -- -s \"SELECT * FROM users, orders, products LIMIT 1\" tests/data/users.csv tests/data/orders.csv tests/data/products.csv -v"

[[workflows.workflow]]
name = "Test Inner Join With Correct Names"
author = "agent"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "cd $(pwd) && cargo run --bin sqawk -- -s \"SELECT users_orders_cross.users.name, products.name, products.price, users_orders_cross.orders.date FROM users, orders, products WHERE users_orders_cross.orders.user_id = users_orders_cross.users.id AND users_orders_cross.orders.product_id = products.product_id\" tests/data/users.csv tests/data/orders.csv tests/data/products.csv -v"

[[workflows.workflow]]
name = "Test Simple Join Query"
author = "agent"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "cd $(pwd) && cargo run --bin sqawk -- -s \"SELECT * FROM users, orders WHERE orders.user_id = users.id\" tests/data/users.csv tests/data/orders.csv -v"

[[workflows.workflow]]
name = "Test Three-Way Inner Join"
author = "agent"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "cd $(pwd) && cargo run --bin sqawk -- -s \"SELECT users.name AS user, products.name AS product, products.price, orders.date FROM users, orders, products WHERE orders.user_id = users.id AND orders.product_id = products.product_id\" tests/data/users.csv tests/data/orders.csv tests/data/products.csv -v"

[[workflows.workflow]]
name = "Test Three-Way Inner Join Without Aliases"
author = "agent"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "cd $(pwd) && cargo run --bin sqawk -- -s \"SELECT users.name, products.name, products.price, orders.date FROM users, orders, products WHERE orders.user_id = users.id AND orders.product_id = products.product_id\" tests/data/users.csv tests/data/orders.csv tests/data/products.csv -v"

[deployment]
run = ["sh", "-c", "cargo build && echo \"Testing Sqawk with sample data:\" && cargo run -- -s \"SELECT * FROM sample\" tests/data/sample.csv -v"]
